# OSS Migration Tool

![Python Version](https://img.shields.io/badge/python-3.7%2B-blue)
![License](https://img.shields.io/badge/license-MIT-green)

é˜¿é‡Œäº‘OSSæ•°æ®è¿ç§»å·¥å…·ï¼Œæ”¯æŒå¤šçº¿ç¨‹ã€æ–­ç‚¹ç»­ä¼ ã€æ™ºèƒ½è·³è¿‡çš„å¯¹è±¡å­˜å‚¨æ•°æ®è¿ç§»è§£å†³æ–¹æ¡ˆã€‚

## ğŸŒŸ åŠŸèƒ½ç‰¹æ€§

- **è·¨å­˜å‚¨æ¡¶è¿ç§»**ï¼šæ”¯æŒä¸åŒOSSå­˜å‚¨æ¡¶ä¹‹é—´çš„æ•°æ®è¿ç§»
- **è·¯å¾„é‡å®šå‘**ï¼šè‡ªå®šä¹‰æºè·¯å¾„åˆ°ç›®æ ‡è·¯å¾„çš„æ˜ å°„è§„åˆ™
- **æ™ºèƒ½è·³è¿‡**ï¼š
  - è‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨æ–‡ä»¶ï¼ˆéœ€å¯ç”¨`--skip-exists`ï¼‰
  - è·³è¿‡æºç›®æ ‡è·¯å¾„ç›¸åŒçš„æ–‡ä»¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼š
  - å¤šçº¿ç¨‹å¹¶å‘ä¼ è¾“ï¼ˆé»˜è®¤20çº¿ç¨‹ï¼‰
  - è‡ªé€‚åº”åˆ†é¡µç­–ç•¥ï¼ˆé»˜è®¤æ¯é¡µ500å¯¹è±¡ï¼‰
  - æµé‡æ§åˆ¶è‡ªåŠ¨é‡è¯•ï¼ˆ429é”™è¯¯å¤„ç†ï¼‰
- **å¯è§†åŒ–ç›‘æ§**ï¼š
  - å®æ—¶è¿›åº¦æ˜¾ç¤ºï¼ˆå¤„ç†é€Ÿåº¦/å‰©ä½™æ—¶é—´ï¼‰
  - æˆåŠŸç‡ç»Ÿè®¡æŠ¥è¡¨
- **æ—¥å¿—ç³»ç»Ÿ**ï¼š
  - æˆåŠŸ/å¤±è´¥æ“ä½œè¯¦ç»†è®°å½•
  - è‡ªåŠ¨ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ—¥å¿—æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.7+
- é˜¿é‡Œäº‘OSSè®¿é—®æƒé™ï¼ˆAccessKeyï¼‰

### å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/imjackoe/oss-migration.git
cd oss-migration
python oss_migration.py
```

2. å®‰å…¨ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåˆ›å»º.envæ–‡ä»¶ï¼‰ï¼š
```bash
OSS_ACCESS_KEY_ID=your_access_key_id
OSS_ACCESS_KEY_SECRET=your_access_key_secret
OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com  # æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
```

### âš™ï¸ åŸºæœ¬ä½¿ç”¨

#### åŸºç¡€è¿ç§»å‘½ä»¤
```bash
python oss_migration.py \
  --src oss://source-bucket/source/path/ \
  --dest oss://target-bucket/target/path/
```

#### å¸¦å‚æ•°ç¤ºä¾‹
```bash
python oss_migration.py \
  --src oss://src-bucket/data/2023/ \
  --dest oss://dest-bucket/archive/ \
  --page-size 1000 \
  --workers 50 \
  --skip-exists
```

#### å‚æ•°è¯´æ˜

| å‚æ•°            | ç±»å‹    | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜                                                                 |
|-----------------|---------|------|--------|----------------------------------------------------------------------|
| `--src`         | string  | æ˜¯   | æ—      | æºè·¯å¾„ï¼Œæ ¼å¼ï¼š`oss://bucket-name/path/`                             |
| `--dest`        | string  | æ˜¯   | æ—      | ç›®æ ‡è·¯å¾„ï¼Œæ ¼å¼ï¼š`oss://bucket-name/path/`                           |
| `--page-size`   | int     | å¦   | 500    | åˆ†é¡µå¤§å°ï¼ˆèŒƒå›´ï¼š100-1000ï¼‰ï¼Œå½±å“æ¯æ¬¡åˆ—ä¸¾å¯¹è±¡çš„æ•°é‡                  |
| `--workers`     | int     | å¦   | 20     | å¹¶å‘çº¿ç¨‹æ•°ï¼ˆèŒƒå›´ï¼š5-100ï¼‰ï¼Œæ ¹æ®ç½‘ç»œå¸¦å®½å’ŒæœåŠ¡å™¨æ€§èƒ½è°ƒæ•´             |
| `--skip-exists` | flag    | å¦   | False  | å¯ç”¨ç›®æ ‡å­˜åœ¨æ€§æ£€æŸ¥ï¼Œå­˜åœ¨ç›¸åŒè·¯å¾„æ–‡ä»¶æ—¶è‡ªåŠ¨è·³è¿‡ï¼ˆå¢åŠ APIè°ƒç”¨æ¬¡æ•°ï¼‰   |

## âš™ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å                  | å¿…å¡« | é»˜è®¤å€¼                          | ç¤ºä¾‹                                   | è¯´æ˜                                                                 |
|-------------------------|------|---------------------------------|----------------------------------------|----------------------------------------------------------------------|
| `OSS_ACCESS_KEY_ID`     | æ˜¯   | æ—                               | LTAI5txxxxxxxxxxxx                     | é˜¿é‡Œäº‘è®¿é—®å¯†é’¥ID                                                    |
| `OSS_ACCESS_KEY_SECRET` | æ˜¯   | æ—                               | KZoGwxxxxxxxxxxxxxxxxxxxxxxx          | é˜¿é‡Œäº‘è®¿é—®å¯†é’¥Secret                                                |
| `OSS_ENDPOINT`          | å¦   | oss-cn-hangzhou.aliyuncs.com    | oss-cn-shanghai.aliyuncs.com           | OSSæœåŠ¡ç«¯ç‚¹ï¼Œæ ¹æ®å­˜å‚¨æ¡¶åœ°åŸŸä¿®æ”¹                                      |
| `MAX_WORKERS`           | å¦   | 20                              | 50                                     | æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼ˆå»ºè®®å€¼ï¼š5-100ï¼‰                                     |
| `PAGE_SIZE`             | å¦   | 500                             | 1000                                   | åˆ†é¡µå¤§å°ï¼ˆèŒƒå›´ï¼š100-1000ï¼‰                                          |

## ğŸ“Š æ—¥å¿—ç³»ç»Ÿ

### æ—¥å¿—è·¯å¾„

```bash
logs/
â”œâ”€â”€ [æºbucket]-[æºè·¯å¾„]_to_[ç›®æ ‡bucket]-[ç›®æ ‡è·¯å¾„]_success.log
â””â”€â”€ [æºbucket]-[æºè·¯å¾„]_to_[ç›®æ ‡bucket]-[ç›®æ ‡è·¯å¾„]_fail.log
```

### æ—¥å¿—ç¤ºä¾‹

```log
[SKIP][Fri Apr 19 22:15:03 2025] oss://dest-bucket/images/photo.jpg
[SUCCESS][Fri Apr 19 22:15:05 2025] docs/report.pdf -> archive/2023/report.pdf
```

## ğŸ’¡ æœ€ä½³å®è·µ

### æµ‹è¯•è¿è¡Œ

```bash
# ä½¿ç”¨å°è§„æ¨¡é…ç½®éªŒè¯
python oss_migration.py \
  --src oss://test-bucket/ \
  --dest oss://test-bucket-copy/ \
  --workers 5 \
  --page-size 100
```

### ç”Ÿäº§ç¯å¢ƒè¿ç§»

```bash
# æœ€å¤§åŒ–æ€§èƒ½é…ç½®
python oss_migration.py \
  --src oss://prod-bucket/app-data/ \
  --dest oss://backup-bucket/2023-backup/ \
  --page-size 1000 \
  --workers 100 \
  --skip-exists
```

### å®šæ—¶ä»»åŠ¡é›†æˆ

```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¢é‡å¤‡ä»½
0 2 * * * /usr/bin/python3 /opt/oss-migration/oss_migration.py \
  --src oss://prod-bucket/daily-data/ \
  --dest oss://backup-bucket/archives/ \
  --skip-exists
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®å®‰å…¨
- æ‰§è¡Œè¿ç§»å‰å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è·¯å¾„è§„åˆ™
- ç¡®ä¿ç›®æ ‡å­˜å‚¨æ¡¶æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
- æ•æ„Ÿæ“ä½œå»ºè®®å…ˆå¯ç”¨`--skip-exists`è¿›è¡Œç©ºè·‘æµ‹è¯•

### æƒé™è¦æ±‚
| æ“ä½œç±»å‹       | æºå­˜å‚¨æ¡¶æƒé™          | ç›®æ ‡å­˜å‚¨æ¡¶æƒé™          |
|---------------|-----------------------|-------------------------|
| åˆ—è¡¨å¯¹è±¡       | `oss:ListObjects`     | æ— éœ€                    |
| è¯»å–å¯¹è±¡       | `oss:GetObject`       | æ— éœ€                    |
| å†™å…¥å¯¹è±¡       | æ— éœ€                  | `oss:PutObject`         |
| è·¨æ¡¶å¤åˆ¶       | `oss:GetObject`       | `oss:PutObject`         |

### æˆæœ¬ä¼˜åŒ–
- æ¯10ä¸‡æ¬¡æ“ä½œæˆæœ¬ä¼°ç®—ï¼š
  - ListObjects: Â¥0.1
  - CopyObject: Â¥1.0 
  - HeadObjectï¼ˆå­˜åœ¨æ£€æŸ¥ï¼‰: Â¥0.1
- æ¨èæ‰¹é‡æ“ä½œæ—¶å…³é—­å­˜åœ¨æ£€æŸ¥ï¼ˆ`--skip-exists`ï¼‰

### ç½‘ç»œè¦æ±‚
- å»ºè®®åœ¨é˜¿é‡Œäº‘ECSåŒåœ°åŸŸæ‰§è¡Œè¿ç§»
- è·¨åœ°åŸŸè¿ç§»éœ€ä¿è¯è‡³å°‘100Mbpså¸¦å®½
- å•çº¿ç¨‹é€Ÿåº¦å‚è€ƒï¼š5-15MB/s

## ğŸ¤ å‚ä¸è´¡çŒ®

### è´¡çŒ®æµç¨‹
1. åœ¨GitHubæäº¤Issueæè¿°é—®é¢˜æˆ–å»ºè®®
2. Forkä»“åº“å¹¶åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š
   ```bash
   git checkout -b feat/your-feature
   ```
3. æäº¤ç¬¦åˆè§„èŒƒçš„ä»£ç å˜æ›´ï¼š
   ```bash
    git commit -m "feat: add xxx feature" 
    git commit -m "fix: resolve xxx issue"
   ```
4. æ¨é€åˆ†æ”¯å¹¶åˆ›å»ºPull Request
5. é€šè¿‡CIæµ‹è¯•å’ŒCode Reviewååˆå¹¶

## ğŸ¤ è´¡çŒ®æ–¹å‘

### ä¸»è¦è´¡çŒ®é¢†åŸŸ
- **åè®®æ‰©å±•**  
  æ·»åŠ å¯¹AWS S3ã€Google Cloud Storageç­‰å…¶ä»–äº‘å­˜å‚¨çš„æ”¯æŒ
- **æ€§èƒ½ä¼˜åŒ–**  
  å®ç°é›¶æ‹·è´ä¼ è¾“ã€å‹ç¼©ä¼ è¾“ç­‰é«˜æ•ˆä¼ è¾“æ¨¡å¼
- **å®‰å…¨å¢å¼º**  
  æ”¯æŒå®¢æˆ·ç«¯åŠ å¯†ã€å®Œæ•´æ€§æ ¡éªŒç­‰å®‰å…¨ç‰¹æ€§
- **ç›‘æ§é›†æˆ**  
  æ·»åŠ Prometheusç›‘æ§æŒ‡æ ‡å¯¼å‡ºåŠŸèƒ½
- **æµ‹è¯•è¦†ç›–**  
  ç¼–å†™å•å…ƒæµ‹è¯•/é›†æˆæµ‹è¯•ç”¨ä¾‹ï¼Œæå‡æµ‹è¯•è¦†ç›–ç‡

### å…¶ä»–è´¡çŒ®æ–¹å¼
- å®Œå–„é¡¹ç›®æ–‡æ¡£ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
- ç¿»è¯‘å›½é™…åŒ–èµ„æº
- ä¿®å¤å·²æŠ¥å‘Šçš„Issues
- ä¼˜åŒ–ä»£ç ç»“æ„
- æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ“œ License

[![MIT License](https://img.shields.io/github/license/imjackoe/oss-migration?style=flat-square)](https://opensource.org/licenses/MIT)
